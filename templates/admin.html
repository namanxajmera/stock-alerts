<!DOCTYPE html>
<html>
<head>
    <title>Admin Panel</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        h2 { color: #333; cursor: pointer; user-select: none; }
        h2:hover { background-color: #f5f5f5; }
        .count { color: #666; font-size: 14px; }
        .section { border: 1px solid #ddd; margin: 10px 0; }
        .section-header { background-color: #f8f9fa; padding: 10px; }
        .section-content { padding: 10px; display: block; }
        .collapsed { display: none; }
        .toggle { font-size: 18px; margin-right: 10px; }
    </style>
    <script>
        function toggleSection(id) {
            const content = document.getElementById(id);
            const toggle = document.getElementById(id + '-toggle');
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                toggle.textContent = '▼';
            } else {
                content.classList.add('collapsed');
                toggle.textContent = '▶';
            }
        }
    </script>
</head>
<body>
    <h1>Database Admin Panel</h1>

    <div class="section">
        <div class="section-header" onclick="toggleSection('users')">
            <span id="users-toggle" class="toggle">▼</span>
            <strong>Users</strong> <span class="count">({{ users|length }} total)</span>
        </div>
        <div id="users" class="section-content">
            <table>
                <tr><th>ID</th><th>Name</th><th>Joined</th><th>Max Stocks</th><th>Notifications</th></tr>
                {% for user in users %}
                <tr>
                    <td>{{ user.id }}</td>
                    <td>{{ user.name }}</td>
                    <td>{{ user.joined_at }}</td>
                    <td>{{ user.max_stocks }}</td>
                    <td>{{ '✓' if user.notification_enabled else '✗' }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
    </div>

    <div class="section">
        <div class="section-header" onclick="toggleSection('watchlist')">
            <span id="watchlist-toggle" class="toggle">▼</span>
            <strong>Watchlist Items</strong> <span class="count">({{ watchlist|length }} total)</span>
        </div>
        <div id="watchlist" class="section-content">
            <table>
                <tr><th>User ID</th><th>Symbol</th><th>Added</th><th>Low Threshold</th><th>High Threshold</th></tr>
                {% for item in watchlist %}
                <tr>
                    <td>{{ item.user_id }}</td>
                    <td>{{ item.symbol }}</td>
                    <td>{{ item.added_at }}</td>
                    <td>{{ item.alert_threshold_low }}</td>
                    <td>{{ item.alert_threshold_high }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
    </div>

    <div class="section">
        <div class="section-header" onclick="toggleSection('alerts')">
            <span id="alerts-toggle" class="toggle">▼</span>
            <strong>Alert History</strong> <span class="count">({{ alerts|length }} recent)</span>
        </div>
        <div id="alerts" class="section-content">
            <table>
                <tr><th>User ID</th><th>Symbol</th><th>Price</th><th>Percentile</th><th>Status</th><th>Sent At</th></tr>
                {% for alert in alerts %}
                <tr>
                    <td>{{ alert.user_id }}</td>
                    <td>{{ alert.symbol }}</td>
                    <td>${{ "%.2f"|format(alert.price) }}</td>
                    <td>{{ "%.1f"|format(alert.percentile) }}%</td>
                    <td>{{ alert.status }}</td>
                    <td>{{ alert.sent_at }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
    </div>

    <div class="section">
        <div class="section-header" onclick="toggleSection('cache')">
            <span id="cache-toggle" class="toggle">▼</span>
            <strong>Stock Cache</strong> <span class="count">({{ cache|length }} cached)</span>
        </div>
        <div id="cache" class="section-content">
            <table>
                <tr><th>Symbol</th><th>Last Price</th><th>MA200</th><th>Last Check</th></tr>
                {% for item in cache %}
                <tr>
                    <td>{{ item.symbol }}</td>
                    <td>{% if item.last_price %}${{ "%.2f"|format(item.last_price) }}{% else %}N/A{% endif %}</td>
                    <td>{% if item.ma_200 %}${{ "%.2f"|format(item.ma_200) }}{% else %}N/A{% endif %}</td>
                    <td>{{ item.last_check }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
    </div>

    <div class="section">
        <div class="section-header" onclick="toggleSection('config')">
            <span id="config-toggle" class="toggle">▼</span>
            <strong>Configuration</strong> <span class="count">({{ config|length }} settings)</span>
        </div>
        <div id="config" class="section-content">
            <table>
                <tr><th>Key</th><th>Value</th><th>Description</th></tr>
                {% for item in config %}
                <tr>
                    <td>{{ item.key }}</td>
                    <td>{{ item.value }}</td>
                    <td>{{ item.description or '' }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
    </div>
</body>
</html> 